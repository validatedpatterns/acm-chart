suite: Test multicluster with default values
templates:
  - templates/multiclusterhub.yaml
release:
  name: release-test
tests:
  - it: Should output default values
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: MultiClusterHub
      - containsDocument:
          kind: MultiClusterHub
          apiVersion: operator.open-cluster-management.io/v1
          name: multiclusterhub
          namespace: open-cluster-management
      - equal:
          path: metadata.annotations["installer.open-cluster-management.io/mce-subscription-spec"]
          value: '{"source": "redhat-operators" }'

  - it: Should change the source when specified
    set:
      acm:
        mce_operator:
          source: foo-source
    asserts:
      - equal:
          path: metadata.annotations["installer.open-cluster-management.io/mce-subscription-spec"]
          value: '{"source": "foo-source" }'

  - it: Should change the source and channel when specified
    set:
      acm:
        mce_operator:
          source: foo-source
          channel: foo-channel
    asserts:
      - equal:
          path: metadata.annotations["installer.open-cluster-management.io/mce-subscription-spec"]
          value: '{"source": "foo-source","channel": "foo-channel" }'

  - it: Should have empty spec by default
    asserts:
      - equal:
          path: spec
          value: {}

  - it: Should set custom spec when mch_spec is provided
    set:
      acm:
        mch_spec:
          disableHubSelfManagement: true
          availabilityConfig: High
    asserts:
      - equal:
          path: spec.disableHubSelfManagement
          value: true
      - equal:
          path: spec.availabilityConfig
          value: High

  - it: Should set nested spec properties when mch_spec has nested values
    set:
      acm:
        mch_spec:
          overrides:
            components:
              - name: cluster-backup
                enabled: true
    asserts:
      - equal:
          path: spec.overrides.components[0].name
          value: cluster-backup
      - equal:
          path: spec.overrides.components[0].enabled
          value: true
